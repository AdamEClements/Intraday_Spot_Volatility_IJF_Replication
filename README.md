# Replicating the IBM Results for “Modeling and Forecasting Intraday Spot Volatility”

Each section below corresponds to sets of results presented in the paper. For each section, there is a folder in this repository — with the same name as the section — containing the relevant data, code, and output.

## Data

- **Raw data file:** `IBM.N5MinuteOHLC.csv`.
- Use `sort_5minute_data.m` (tested in MATLAB R2024b) to filter the raw 5-minute data.
- The output for the 5-minute OK volatility is saved as `IBM_5minvol_Win.mat` for use in subsequent MATLAB code.
- The 5-minute OK volatility is also stored in `IBM_ok.csv`.

## In-sample and Figure 1

- `intravol_model.m` provides the full-sample estimation results.
- It uses `IBM_5minvol_Win.mat` as input and computes the parameter estimates (`IBM_OLS_estimates.csv`) and the robust covariance matrix (`IBM_robust_scaled_covars.csv`).
- These output files are then used in `IBM_HAC_based_plots.qmd` to produce Figure 1. The `.qmd` file requires the `dplyr` and `readr` R packages.

## Residual ACF Plots in Figure 2

### Residual Files

- **Residuals for miHAR:** `IBM_miHAR_resids.csv` — generated by `intravol_model.m`.
- **Residuals for diHAR:** `IBM_diHAR_resids.csv` — generated by `intravol_seasHAR_model.m`.
- **Residuals for liGBM:** `IBM_gbm_resid.csv` — generated by `gbm_residuals2.py`.
- **Residuals for LSTM:** `IBM_LSTM_resid.csv` — generated by `residuals_LSTM.m`.

### ACF Generation

- `get_ACF.r` uses the files above to generate ACFs and writes the results to `SACFs.csv`.
- `SACFs.qmd` then uses `SACFs.csv` to produce Figure 2. The `.qmd` file requires the `dplyr` and `readr` R packages.

## Loss Ratios and Figure 3

- `loss_ratios.csv` is generated by `compare_forecasts.m`.
- `loss_ratios.qmd` reads `loss_ratios.csv` and produces Figure 3. The `.qmd` file requires the `dplyr` and `readr` R packages.

## Logarithmic Models and Table 2

- `forecasting_log_loop.m` uses `IBM_5minvol_Win.mat` and produces the logarithmic miHAR and diHAR forecasts. Output is written to `IBM_multireg_fore_log.csv`.
- `IBM_gbm_fore_log.py` uses `IBM_ok.csv` and writes the output to `IBM_gbm_fore_log.csv`.
- `forecasting_log_loop_LSTM.m` generates the log-LSTM forecasts and writes the output to `IBM_lstm_fore_log.csv`.

## Multi-step Forecasts and Table 3

### Multi-step Ahead Forecasts

`forecasting_loop_multistep.m` is used to generate the multi-step ahead forecasts for the miHAR and diHAR models.

<pre>
% Forecast horizon
forwin = 2;
</pre>

The variable `forwin` sets the forecast horizon. For a 2-interval horizon, the output is written to `IBM_2_multireg_fore.csv`.

`gbm_rolling_multistep.py` is used to generate the liGBM forecasts, written to `IBM_2_gbm_fore.csv`.
Similarly, in this script:

<pre>
# Forecast horizon
forwin = 2
</pre>

sets the forecast horizon.

`forecasting_loop_LSTM_multistep.m` is used to generate the LSTM forecasts.

### Logarithmic Models

`forecasting_log_loop_multistep.m` generates the multi-step ahead forecasts for the log-miHAR and log-diHAR models.

<pre>
% Forecast horizon
forwin = 2;
</pre>

sets the forecast horizon. The output is written to `IBM_2_multireg_fore_log.csv`.

`gbm_rolling_multistep_log.py` generates the multi-step ahead forecasts for the log-liGBM model, written to `IBM_2_gbm_fore_log.csv`.

`forecasting_log_loop_LSTM_multistep.m` generates the multi-step ahead forecasts for the log-LSTM model, written to `IBM_2_lstm_fore_log.csv`.

### Generating Results

- To generate the results in Table 3, use `compare_forecasts.m`.
- To generate the results in Table 2, use `compare_log_forecasts.m`.

### File Naming Convention

To generate results for different horizons or log models, update the file names as follows:

<pre>
IBM_2_multireg_fore.csv
IBM_6_multireg_fore.csv
IBM_2_multireg_fore_log.csv
IBM_6_multireg_fore_log.csv
</pre>

The same naming convention applies to the liGBM and LSTM forecast files.

## Overnight Volatility and Table 4 and Figure 4

### In-Sample Estimation (No Overnight Volatility)

`intravol_model_noonight.m` is used to generate the in-sample estimation results for the miHAR model, excluding overnight volatility.
It computes the parameters estimates (`IBM_OLS_estimates.csv`) and robust covariance matrix (`IBM_robust_scaled_covars.csv`) for producing Figure 4.

These files are then used in `IBM_HAC_based_plots.qmd` to generate Figure 4. The `.qmd` file requires the `dplyr` and `readr` packages.

### Forecasting (No Overnight Volatility)

`forecasting_loop.m` produces the miHAR$^{*}$ forecasts. The forecasts are written to `IBM_fore_nonight.csv`.

To generate the results in Table 4, use `compare_forecasts.m`.

## Diurnal Adjustment and Table 5

`forecasting_diurnal_loop.m` produces forecasts based on the diurnally adjusted volatility miHAR model.
The output is written to `IBM_multireg_di_fore.csv`.

To generate the results in Table 5, use `compare_forecasts.m`.

## Fixed Model and Table 7

`forecasting_loop_fixedmodel.m` is used to generate the miHAR$^{F}$ forecasts.
The output is written to `IBM_multireg_fore_fix.csv`.

To generate the results in Table 7, use `compare_forecasts.m`.

## Simpler Models and Table 8

`forecasting_loop_simpler.m` is used to generate forecasts for the different versions of the simpler models.

To select which predictors to include, modify the following section of the code:

<pre>
% Set whether to use daily lags or overnight volatility
useday = 1;
usenight = 0;
</pre>

The output file name will automatically update as follows:

- `IBM_multireg_fore_simple_0_0.csv` — miHAR$^I$ forecasts
- `IBM_multireg_fore_simple_0_1.csv` — miHAR$^{OI}$ forecasts
- `IBM_multireg_fore_simple_1_0.csv` — miHAR$^{DI}$ forecasts

To generate the results in Table 8, use `compare_forecasts.m`.


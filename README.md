# Intraday_Spot_Volatility_IJF_Replication
For replicating the IBM results for 'Modeling and Forecasting Intraday Spot Volatility'

Each section below relates to sets of results in the paper. There is a folder in the repository (with the same name as each section) that contains the relevant data, code and output.

## Data
Raw data file: IBM.N5MinuteOHLC.csv

Use sort_5minute_data.m (used Matlab 2024b) to filter the raw 5-minute data

Output for the 5-minute OK volatility is written to IBM_5minvol_Win.mat to use in subsequent Matlab code

5-minute OK volatility is laos stored in IBM_ok.csv

## In-sample and Figure 1

intravol_model.m provides the full sample estimation results.

intravol_model.m uses IBM_5minvol_Win.mat

Writes out coefficient estimates (IBM_OLS_estimates.csv) and robust covariance matrix 
(IBM_robust_scaled_covars.csv) to produce Figure 1

These files are used in the R code in IBM_HAC_based_plots.qmd to generate Figure 1
IBM_HAC_based_plots.qmd needs the dplyr readr libraries.

## Residual ACF plots in Figure 2

Resiuduals for miHAR model
IBM_miHAR_resids.csv is generated by intravol_model.m

Residuals for diHAR model
IBM_miHAR_resids.csv is generated by intravol_seasHAR_model.m

Resdiduals for liGBM
IBM_gbm_resid.csv is generated by gbm_residuals2.py

Resdiduals for LSTM
IBM_LSTM_resid.csv is generated by residuals_LSTM.m

get_ACF.r uses the files above to generate ACFs and output to SACFs.csv

SACFs.qmd uses SACFs.csv to generate Figure 2 needs the dplyr readr libraries

## Loss ratios and Figure 3

loss_ratios.csv is generated by compare_forecasts.m

loss_ratios.qmd reads in loss_ratios.csv and generates Figure 3

## Logarithmic models and Table 2

Forecasting_log_loop.m uses IBM_5minvol_Win.mat
Produces the logarithmic miHAR and diHAR forecasts 
Written out to IBM_multireg_fore_log.csv

IBM_gbm_fore_log.py uses IBM_ok.csv and output is written IBM_gbm_fore_log.csv

forecasting_log_loop_LSTM.m generates the log LSTM forecasts and output is written to IBM_lstm_fore_log.csv

## Multi-step forecasts and Table 3

forecasting_loop_multistep.m is used to genertae the multi-step ahead forecasts for the miHAR and diHAR

%Forecast horizon
forwin = 2;

sets the forecast horizon. For a 2-interval horizon, the output is IBM_2_multireg_fore.csv

gbm_rolling_multistep.py is used to generate the liGBM forecasts IBM_2_gbm_fore.csv

Again change

#Forecast horizon
forwin = 2

sets the forecast horizon

forecasting_loop_LSTM_multistep.m is used to generate the LSTM forecasts 

Logarithmic models

forecasting_log_loop_multistep.m generates the multi-step ahead forecasts for the log miHAR and diHAR

% Forecast horizon
forwin = 2;

sets the forecast horizon.

Written out to IBM_2_multireg_fore_log.csv

gbm_rolling_multistep_log.py generates the multi-step ahead forecasts for the log liGBM forecasts IBM_2_gbm_fore_log.csv

forecasting_log_loop_LSTM_multistep.m generates the multi-step ahead forecasts for the log LSTM forecasts IBM_2_lstm_fore_log.csv

To generate the results in Table 3: compare_forecasts.m is used

To generate the results for the different horizons and log models, the file names can simply be changed:

IBM_2_multireg_fore.csv
IBM_6_multireg_fore.csv
IBM_2_multireg_fore_log.csv
IBM_6_multireg_fore_log.csv

The same is done for the liGBM and LSTM files.

To generate the results in Table 2: compare_log_forecasts.m is used

## Overnight volatility and Table 4 and Figure 4

intravol_model_noonight.m is used to generate the in-sample estimation results for the miHAR model 
excluding overnight volatility.

Writes out coefficient estimates (IBM_OLS_estimates.csv) and robust covariance matrix 
(IBM_robust_scaled_covars.csv) to produce Figure 4

These files are used in the R code in IBM_HAC_based_plots.qmd to generate Figure 4
IBM_HAC_based_plots.qmd needs the dplyr readr libraries.

forecasting_loop.m produces the miHAR* forecasts

Forecasts are written out to IBM_fore_nonight.csv

To generate the results in Table 4: compare_forecasts.m is used
